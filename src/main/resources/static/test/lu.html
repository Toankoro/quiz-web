<!DOCTYPE html>
<html>
<head>
    <title>Test Notification</title>
    <meta charset="UTF-8">
</head>
<body>
    <h2>WebSocket Notification Test</h2>

    <button onclick="connect()">K·∫øt n·ªëi WebSocket</button>
    <br><br>

    <input type="text" id="username" placeholder="T√™n ng∆∞·ªùi nh·∫≠n" value="tungnguyen">
    <input type="text" id="message" placeholder="N·ªôi dung th√¥ng b√°o" value="Xin ch√†o!">
    <button onclick="sendNotification()">G·ª≠i Th√¥ng B√°o</button>

    <div id="log" style="margin-top:20px; color: green;"></div>

    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <script>
        let stompClient = null;
        const token = "Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ0dW5nbmd1eWVuIiwicm9sZSI6IlJPTEVfVVNFUiIsImlhdCI6MTc1NDI5ODgzNiwiZXhwIjoxNzU0Mzg1MjM2fQ.qRiXC5Oh7wr7ivMQLJSj8EAgL9oRYOJpf4tRS3dZ_J8";

        function log(msg) {
            const div = document.getElementById("log");
            div.innerHTML += `<p>${new Date().toLocaleTimeString()} - ${msg}</p>`;
        }

        function connect() {
            const socket = new SockJS("http://localhost:8080/ws");
            stompClient = Stomp.over(socket);
            stompClient.debug = null;

            stompClient.connect({ Authorization: token }, frame => {
                log("‚úÖ ƒê√£ k·∫øt n·ªëi: " + frame);
                stompClient.subscribe("/user/queue/notifications", message => {
                    log("üì© Tin nh·∫Øn ƒë·∫øn: " + message.body);
                    console.log(message);
                }, { Authorization: token });
            }, error => {
                log("‚ùå L·ªói k·∫øt n·ªëi: " + error);
            });
        }

        function sendNotification() {
            const username = document.getElementById("username").value;
            const message = document.getElementById("message").value;

            fetch("http://localhost:8080/api/test/send-notification?username=" + username + "&message=" + message, {
                method: "POST",
                headers: {
                    "Authorization": token
                }
            })
            .then(res => res.text())
            .then(txt => log("‚úÖ " + txt))
            .catch(err => log("‚ùå " + err));
        }
    </script>
</body>
</html>
